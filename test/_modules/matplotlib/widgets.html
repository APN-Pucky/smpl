

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>matplotlib.widgets &mdash; smpl  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> smpl
          

          
          </a>

          
            
            
              <div class="version">
                1.0.3-8-gfb8e1de3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Versions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/smpl/">Stable</a></li>
<li class="toctree-l1"><a class="reference external" href="https://apn-pucky.github.io/smpl/test/">Dev</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/APN-Pucky/smpl">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/smpl.html">smpl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Profiling:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Graph Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/line.html">Line Profiling</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">smpl</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../matplotlib.html">matplotlib</a> &raquo;</li>
        
      <li>matplotlib.widgets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for matplotlib.widgets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GUI neutral widgets</span>
<span class="sd">===================</span>

<span class="sd">Widgets that are designed to work for any of the GUI backends.</span>
<span class="sd">All of these widgets require you to predefine a `matplotlib.axes.Axes`</span>
<span class="sd">instance and pass that as the first parameter.  Matplotlib doesn&#39;t try to</span>
<span class="sd">be too smart with respect to layout -- you will have to figure out how</span>
<span class="sd">wide and tall you want your Axes to be to accommodate your widget.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">ExitStack</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Number</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="p">(</span><span class="n">_api</span><span class="p">,</span> <span class="n">_docstring</span><span class="p">,</span> <span class="n">backend_tools</span><span class="p">,</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span>
               <span class="n">transforms</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">.transforms</span> <span class="kn">import</span> <span class="n">TransformedPatchPath</span><span class="p">,</span> <span class="n">Affine2D</span>


<span class="k">class</span> <span class="nc">LockDraw</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some widgets, like the cursor, draw onto the canvas, and this is not</span>
<span class="sd">    desirable under all circumstances, like when the toolbar is in zoom-to-rect</span>
<span class="sd">    mode and drawing a rectangle.  To avoid this, a widget can acquire a</span>
<span class="sd">    canvas&#39; lock with ``canvas.widgetlock(widget)`` before drawing on the</span>
<span class="sd">    canvas; this will prevent other widgets from doing so at the same time (if</span>
<span class="sd">    they also try to acquire the lock first).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reserve the lock for *o*.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;already locked&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Release the lock from *o*.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;you do not own this lock&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether drawing is available to *o*.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isowner</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isowner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether *o* owns this lock.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="ow">is</span> <span class="n">o</span>

    <span class="k">def</span> <span class="nf">locked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the lock is currently held by an owner.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>


<div class="viewcode-block" id="Widget"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Widget.html#smpl.plot.Widget">[docs]</a><span class="k">class</span> <span class="nc">Widget</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for GUI neutral widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">drawon</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">eventson</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_active</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Widget.set_active"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Widget.html#smpl.plot.Widget.set_active">[docs]</a>    <span class="k">def</span> <span class="nf">set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set whether the widget is active.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="n">active</span></div>

<div class="viewcode-block" id="Widget.get_active"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Widget.html#smpl.plot.Widget.get_active">[docs]</a>    <span class="k">def</span> <span class="nf">get_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get whether the widget is active.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span></div>

    <span class="c1"># set_active is overridden by SelectorWidgets.</span>
    <span class="n">active</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_active</span><span class="p">,</span> <span class="n">set_active</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Is the widget active?&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Widget.ignore"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Widget.html#smpl.plot.Widget.ignore">[docs]</a>    <span class="k">def</span> <span class="nf">ignore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether *event* should be ignored.</span>

<span class="sd">        This method should be called at the beginning of any event callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span></div></div>


<span class="k">class</span> <span class="nc">AxesWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Widget connected to a single `~matplotlib.axes.Axes`.</span>

<span class="sd">    To guarantee that the widget remains responsive and not garbage-collected,</span>
<span class="sd">    a reference to the object should be maintained by the user.</span>

<span class="sd">    This is necessary because the callback registry</span>
<span class="sd">    maintains only weak-refs to the functions, which are member</span>
<span class="sd">    functions of the widget.  If there are no references to the widget</span>
<span class="sd">    object it may be garbage collected which will disconnect the callbacks.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>
<span class="sd">    canvas : `~matplotlib.backend_bases.FigureCanvasBase`</span>
<span class="sd">        The parent figure canvas for the widget.</span>
<span class="sd">    active : bool</span>
<span class="sd">        If False, the widget does not respond to events.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cids</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">connect_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect a callback function with an event.</span>

<span class="sd">        This should be used in lieu of ``figure.canvas.mpl_connect`` since this</span>
<span class="sd">        function stores callback ids for later clean up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disconnect all events created by this widget.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


<div class="viewcode-block" id="Button"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Button.html#smpl.plot.Button">[docs]</a><span class="k">class</span> <span class="nc">Button</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GUI neutral button.</span>

<span class="sd">    For the button to remain responsive you must keep a reference to it.</span>
<span class="sd">    Call `.on_clicked` to connect to the button.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ax</span>
<span class="sd">        The `matplotlib.axes.Axes` the button renders into.</span>
<span class="sd">    label</span>
<span class="sd">        A `matplotlib.text.Text` instance.</span>
<span class="sd">    color</span>
<span class="sd">        The color of the button when not hovering.</span>
<span class="sd">    hovercolor</span>
<span class="sd">        The color of the button when hovering.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Button.__init__"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Button.html#smpl.plot.Button.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.85&#39;</span><span class="p">,</span> <span class="n">hovercolor</span><span class="o">=</span><span class="s1">&#39;0.95&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`</span>
<span class="sd">            The `~.axes.Axes` instance the button will be placed into.</span>
<span class="sd">        label : str</span>
<span class="sd">            The button text.</span>
<span class="sd">        image : array-like or PIL Image</span>
<span class="sd">            The image to place in the button, if not *None*.  The parameter is</span>
<span class="sd">            directly forwarded to `~matplotlib.axes.Axes.imshow`.</span>
<span class="sd">        color : color</span>
<span class="sd">            The color of the button when not activated.</span>
<span class="sd">        hovercolor : color</span>
<span class="sd">            The color of the button when the mouse is over it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
                             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                             <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">CallbackRegistry</span><span class="p">(</span><span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;clicked&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motion</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hovercolor</span> <span class="o">=</span> <span class="n">hovercolor</span></div>

    <span class="k">def</span> <span class="nf">_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grab_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">release_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;clicked&#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hovercolor</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">colors</span><span class="o">.</span><span class="n">same_color</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<div class="viewcode-block" id="Button.on_clicked"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Button.html#smpl.plot.Button.on_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect the callback function *func* to button click events.</span>

<span class="sd">        Returns a connection id, which can be used to disconnect the callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;clicked&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">event</span><span class="p">))</span></div>

<div class="viewcode-block" id="Button.disconnect"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Button.html#smpl.plot.Button.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the callback function with connection id *cid*.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">SliderBase</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The base class for constructing Slider widgets. Not intended for direct</span>
<span class="sd">    usage.</span>

<span class="sd">    For the slider to remain responsive you must maintain a reference to it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">closedmin</span><span class="p">,</span> <span class="n">closedmax</span><span class="p">,</span>
                 <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">valfmt</span><span class="p">,</span> <span class="n">dragging</span><span class="p">,</span> <span class="n">valstep</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;3d&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Sliders cannot be added to 3D Axes&#39;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">],</span> <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedmin</span> <span class="o">=</span> <span class="n">closedmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closedmax</span> <span class="o">=</span> <span class="n">closedmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valmin</span> <span class="o">=</span> <span class="n">valmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span> <span class="o">=</span> <span class="n">valmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valstep</span> <span class="o">=</span> <span class="n">valstep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valfmt</span> <span class="o">=</span> <span class="n">valfmt</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">))</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">))</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">get_major_formatter</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="p">,</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">set_useOffset</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># No additive offset.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">set_useMathText</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># x sign before multiplicative offset.</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s2">&quot;button_press_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s2">&quot;button_release_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dragging</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">CallbackRegistry</span><span class="p">(</span><span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;changed&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_stepped_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return *val* coerced to closest number in the ``valstep`` grid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valstep</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valmin</span>
                   <span class="o">+</span> <span class="nb">round</span><span class="p">((</span><span class="n">val</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmin</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">valstep</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">valstep</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">valstep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valstep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valstep</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">valstep</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;valstep must have 1 dimension but has </span><span class="si">{</span><span class="n">valstep</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">valstep</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">valstep</span> <span class="o">-</span> <span class="n">val</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the observer with connection id *cid*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            Connection id of the observer to be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the slider to the initial value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valinit</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valinit</span><span class="p">)</span>


<div class="viewcode-block" id="Slider"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Slider.html#smpl.plot.Slider">[docs]</a><span class="k">class</span> <span class="nc">Slider</span><span class="p">(</span><span class="n">SliderBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A slider representing a floating point range.</span>

<span class="sd">    Create a slider from *valmin* to *valmax* in Axes *ax*. For the slider to</span>
<span class="sd">    remain responsive you must maintain a reference to it. Call</span>
<span class="sd">    :meth:`on_changed` to connect to the slider event.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    val : float</span>
<span class="sd">        Slider value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Slider.__init__"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Slider.html#smpl.plot.Slider.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">valfmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">closedmin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">closedmax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slidermin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">slidermax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dragging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">valstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">initcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                 <span class="n">track_color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">handle_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : Axes</span>
<span class="sd">            The Axes to put the slider in.</span>

<span class="sd">        label : str</span>
<span class="sd">            Slider label.</span>

<span class="sd">        valmin : float</span>
<span class="sd">            The minimum value of the slider.</span>

<span class="sd">        valmax : float</span>
<span class="sd">            The maximum value of the slider.</span>

<span class="sd">        valinit : float, default: 0.5</span>
<span class="sd">            The slider initial position.</span>

<span class="sd">        valfmt : str, default: None</span>
<span class="sd">            %-format string used to format the slider value.  If None, a</span>
<span class="sd">            `.ScalarFormatter` is used instead.</span>

<span class="sd">        closedmin : bool, default: True</span>
<span class="sd">            Whether the slider interval is closed on the bottom.</span>

<span class="sd">        closedmax : bool, default: True</span>
<span class="sd">            Whether the slider interval is closed on the top.</span>

<span class="sd">        slidermin : Slider, default: None</span>
<span class="sd">            Do not allow the current slider to have a value less than</span>
<span class="sd">            the value of the Slider *slidermin*.</span>

<span class="sd">        slidermax : Slider, default: None</span>
<span class="sd">            Do not allow the current slider to have a value greater than</span>
<span class="sd">            the value of the Slider *slidermax*.</span>

<span class="sd">        dragging : bool, default: True</span>
<span class="sd">            If True the slider can be dragged by the mouse.</span>

<span class="sd">        valstep : float or array-like, default: None</span>
<span class="sd">            If a float, the slider will snap to multiples of *valstep*.</span>
<span class="sd">            If an array the slider will snap to the values in the array.</span>

<span class="sd">        orientation : {&#39;horizontal&#39;, &#39;vertical&#39;}, default: &#39;horizontal&#39;</span>
<span class="sd">            The orientation of the slider.</span>

<span class="sd">        initcolor : color, default: &#39;r&#39;</span>
<span class="sd">            The color of the line at the *valinit* position. Set to ``&#39;none&#39;``</span>
<span class="sd">            for no line.</span>

<span class="sd">        track_color : color, default: &#39;lightgrey&#39;</span>
<span class="sd">            The color of the background track. The track is accessible for</span>
<span class="sd">            further styling via the *track* attribute.</span>

<span class="sd">        handle_style : dict</span>
<span class="sd">            Properties of the slider handle. Default values are</span>

<span class="sd">            ========= ===== ======= ========================================</span>
<span class="sd">            Key       Value Default Description</span>
<span class="sd">            ========= ===== ======= ========================================</span>
<span class="sd">            facecolor color &#39;white&#39; The facecolor of the slider handle.</span>
<span class="sd">            edgecolor color &#39;.75&#39;   The edgecolor of the slider handle.</span>
<span class="sd">            size      int   10      The size of the slider handle in points.</span>
<span class="sd">            ========= ===== ======= ========================================</span>

<span class="sd">            Other values will be transformed as marker{foo} and passed to the</span>
<span class="sd">            `~.Line2D` constructor. e.g. ``handle_style = {&#39;style&#39;=&#39;x&#39;}`` will</span>
<span class="sd">            result in ``markerstyle = &#39;x&#39;``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Additional kwargs are passed on to ``self.poly`` which is the</span>
<span class="sd">        `~matplotlib.patches.Polygon` that draws the slider knob.  See the</span>
<span class="sd">        `.Polygon` documentation for valid property names (``facecolor``,</span>
<span class="sd">        ``edgecolor``, ``alpha``, etc.).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">closedmin</span><span class="p">,</span> <span class="n">closedmax</span><span class="p">,</span>
                         <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">valfmt</span><span class="p">,</span> <span class="n">dragging</span><span class="p">,</span> <span class="n">valstep</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">slidermin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">slidermin</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Argument slidermin (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">slidermin</span><span class="p">)</span><span class="si">}</span><span class="s2">) has no &#39;val&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slidermax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">slidermax</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Argument slidermax (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">slidermax</span><span class="p">)</span><span class="si">}</span><span class="s2">) has no &#39;val&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slidermin</span> <span class="o">=</span> <span class="n">slidermin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slidermax</span> <span class="o">=</span> <span class="n">slidermax</span>
        <span class="n">valinit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_in_bounds</span><span class="p">(</span><span class="n">valinit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valinit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valinit</span> <span class="o">=</span> <span class="n">valmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">valinit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valinit</span> <span class="o">=</span> <span class="n">valinit</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;.75&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">handle_style</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">handle_style</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">handle_style</span>
        <span class="n">marker_props</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">{</span><span class="o">**</span><span class="n">defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">handle_style</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">track_color</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhspan</span><span class="p">(</span><span class="n">valmin</span><span class="p">,</span> <span class="n">valinit</span><span class="p">,</span> <span class="mf">.25</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># Drawing a longer line and clipping it to the track avoids</span>
            <span class="c1"># pixelation-related asymmetries.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">valinit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">initcolor</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">clip_path</span><span class="o">=</span><span class="n">TransformedPatchPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">))</span>
            <span class="n">handleXY</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="n">valinit</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.25</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">track_color</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">valmin</span><span class="p">,</span> <span class="n">valinit</span><span class="p">,</span> <span class="mf">.25</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vline</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">valinit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">initcolor</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">clip_path</span><span class="o">=</span><span class="n">TransformedPatchPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">))</span>
            <span class="n">handleXY</span> <span class="o">=</span> <span class="p">[[</span><span class="n">valinit</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="o">*</span><span class="n">handleXY</span><span class="p">,</span>
            <span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">marker_props</span><span class="p">,</span>
            <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                                 <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">valtext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">valinit</span><span class="p">),</span>
                                   <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                                   <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                                 <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">valtext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">valinit</span><span class="p">),</span>
                                   <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                                   <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">valinit</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_value_in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes sure *val* is with given bounds.&quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stepped_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmin</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closedmin</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmin</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closedmax</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidermin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidermin</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closedmin</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidermin</span><span class="o">.</span><span class="n">val</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidermax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidermax</span><span class="o">.</span><span class="n">val</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closedmax</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidermax</span><span class="o">.</span><span class="n">val</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the slider position.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;button_press_event&#39;</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grab_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;button_release_event&#39;</span><span class="p">)</span> <span class="ow">or</span>
              <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;button_press_event&#39;</span> <span class="ow">and</span>
               <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">release_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_in_bounds</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_in_bounds</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pretty-print *val*.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valfmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">valfmt</span> <span class="o">%</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">format_ticks</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">valmin</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span><span class="p">])</span>
            <span class="c1"># fmt.get_offset is actually the multiplicative factor, if any.</span>
            <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">get_offset</span><span class="p">()</span>

<div class="viewcode-block" id="Slider.set_val"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Slider.html#smpl.plot.Slider.set_val">[docs]</a>    <span class="k">def</span> <span class="nf">set_val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set slider value to *val*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.25</span><span class="p">,</span> <span class="n">val</span>
            <span class="n">xy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">,</span> <span class="mf">.75</span>
            <span class="n">xy</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">,</span> <span class="mf">.25</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valtext</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;changed&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="Slider.on_changed"><a class="viewcode-back" href="../../_autosummary/smpl.plot.Slider.html#smpl.plot.Slider.on_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect *func* as callback function to changes of the slider value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Function to call when slider is changed.</span>
<span class="sd">            The function must accept a single float as its arguments.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Connection id (which can be used to disconnect *func*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;changed&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></div></div>


<span class="k">class</span> <span class="nc">RangeSlider</span><span class="p">(</span><span class="n">SliderBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A slider representing a range of floating point values. Defines the min and</span>
<span class="sd">    max of the range via the *val* attribute as a tuple of (min, max).</span>

<span class="sd">    Create a slider that defines a range contained within [*valmin*, *valmax*]</span>
<span class="sd">    in Axes *ax*. For the slider to remain responsive you must maintain a</span>
<span class="sd">    reference to it. Call :meth:`on_changed` to connect to the slider event.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    val : tuple of float</span>
<span class="sd">        Slider value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">valmin</span><span class="p">,</span>
        <span class="n">valmax</span><span class="p">,</span>
        <span class="n">valinit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">valfmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">closedmin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">closedmax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dragging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">valstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
        <span class="n">track_color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span>
        <span class="n">handle_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : Axes</span>
<span class="sd">            The Axes to put the slider in.</span>

<span class="sd">        label : str</span>
<span class="sd">            Slider label.</span>

<span class="sd">        valmin : float</span>
<span class="sd">            The minimum value of the slider.</span>

<span class="sd">        valmax : float</span>
<span class="sd">            The maximum value of the slider.</span>

<span class="sd">        valinit : tuple of float or None, default: None</span>
<span class="sd">            The initial positions of the slider. If None the initial positions</span>
<span class="sd">            will be at the 25th and 75th percentiles of the range.</span>

<span class="sd">        valfmt : str, default: None</span>
<span class="sd">            %-format string used to format the slider values.  If None, a</span>
<span class="sd">            `.ScalarFormatter` is used instead.</span>

<span class="sd">        closedmin : bool, default: True</span>
<span class="sd">            Whether the slider interval is closed on the bottom.</span>

<span class="sd">        closedmax : bool, default: True</span>
<span class="sd">            Whether the slider interval is closed on the top.</span>

<span class="sd">        dragging : bool, default: True</span>
<span class="sd">            If True the slider can be dragged by the mouse.</span>

<span class="sd">        valstep : float, default: None</span>
<span class="sd">            If given, the slider will snap to multiples of *valstep*.</span>

<span class="sd">        orientation : {&#39;horizontal&#39;, &#39;vertical&#39;}, default: &#39;horizontal&#39;</span>
<span class="sd">            The orientation of the slider.</span>

<span class="sd">        track_color : color, default: &#39;lightgrey&#39;</span>
<span class="sd">            The color of the background track. The track is accessible for</span>
<span class="sd">            further styling via the *track* attribute.</span>

<span class="sd">        handle_style : dict</span>
<span class="sd">            Properties of the slider handles. Default values are</span>

<span class="sd">            ========= ===== ======= =========================================</span>
<span class="sd">            Key       Value Default Description</span>
<span class="sd">            ========= ===== ======= =========================================</span>
<span class="sd">            facecolor color &#39;white&#39; The facecolor of the slider handles.</span>
<span class="sd">            edgecolor color &#39;.75&#39;   The edgecolor of the slider handles.</span>
<span class="sd">            size      int   10      The size of the slider handles in points.</span>
<span class="sd">            ========= ===== ======= =========================================</span>

<span class="sd">            Other values will be transformed as marker{foo} and passed to the</span>
<span class="sd">            `~.Line2D` constructor. e.g. ``handle_style = {&#39;style&#39;=&#39;x&#39;}`` will</span>
<span class="sd">            result in ``markerstyle = &#39;x&#39;``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Additional kwargs are passed on to ``self.poly`` which is the</span>
<span class="sd">        `~matplotlib.patches.Polygon` that draws the slider knob.  See the</span>
<span class="sd">        `.Polygon` documentation for valid property names (``facecolor``,</span>
<span class="sd">        ``edgecolor``, ``alpha``, etc.).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">closedmin</span><span class="p">,</span> <span class="n">closedmax</span><span class="p">,</span>
                         <span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">,</span> <span class="n">valfmt</span><span class="p">,</span> <span class="n">dragging</span><span class="p">,</span> <span class="n">valstep</span><span class="p">)</span>

        <span class="c1"># Set a value to allow _value_in_bounds() to work.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">valmin</span><span class="p">,</span> <span class="n">valmax</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">valinit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Place at the 25th and 75th percentiles</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="n">valmax</span> <span class="o">-</span> <span class="n">valmin</span>
            <span class="n">valinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">valmin</span> <span class="o">+</span> <span class="n">extent</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">,</span>
                                <span class="n">valmin</span> <span class="o">+</span> <span class="n">extent</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valinit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_in_bounds</span><span class="p">(</span><span class="n">valinit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">valinit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valinit</span> <span class="o">=</span> <span class="n">valinit</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;.75&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">handle_style</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">handle_style</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">handle_style</span>
        <span class="n">marker_props</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s1">&#39;marker</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">{</span><span class="o">**</span><span class="n">defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">handle_style</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">track_color</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">)</span>
            <span class="n">poly_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span>
            <span class="n">handleXY_1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="n">valinit</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">handleXY_2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="n">valinit</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">track</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.25</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">track_color</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">track</span><span class="p">)</span>
            <span class="n">poly_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;grid&quot;</span><span class="p">)</span>
            <span class="n">handleXY_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">valinit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">.5</span><span class="p">]</span>
            <span class="n">handleXY_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">valinit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">.5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection_poly</span><span class="p">(</span><span class="o">*</span><span class="n">valinit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">poly_transform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="o">.</span><span class="n">get_path</span><span class="p">()</span><span class="o">.</span><span class="n">_interpolation_steps</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">_request_autoscale_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">handleXY_1</span><span class="p">,</span>
                <span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="o">**</span><span class="n">marker_props</span><span class="p">,</span>
                <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">handleXY_2</span><span class="p">,</span>
                <span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="o">**</span><span class="n">marker_props</span><span class="p">,</span>
                <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="mf">1.02</span><span class="p">,</span>
                <span class="n">label</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">valtext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">valinit</span><span class="p">),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="n">label</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">valtext</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">1.02</span><span class="p">,</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">valinit</span><span class="p">),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">valinit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_selection_poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the vertices of the *self.poly* slider in-place</span>
<span class="sd">        to cover the data range *vmin*, *vmax*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The vertices are positioned</span>
        <span class="c1">#  1 ------ 2</span>
        <span class="c1">#  |        |</span>
        <span class="c1"># 0, 4 ---- 3</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="o">.</span><span class="n">xy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.25</span><span class="p">,</span> <span class="n">vmin</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.25</span><span class="p">,</span> <span class="n">vmax</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">vmax</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">vmin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">verts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="mf">.25</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="mf">.75</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="mf">.75</span>
            <span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="mf">.25</span>

    <span class="k">def</span> <span class="nf">_min_in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure the new min value is between valmin and self.val[1].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmin</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closedmin</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmin</span>

        <span class="k">if</span> <span class="nb">min</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stepped_value</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_max_in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure the new max value is between valmax and self.val[0].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">max</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">closedmax</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span>

        <span class="k">if</span> <span class="nb">max</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stepped_value</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_value_in_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clip min, max values to the bounds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_min_in_bounds</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_in_bounds</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_update_val_from_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the slider value based on a given position.&quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span> <span class="n">pos</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_in_bounds</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_min</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_in_bounds</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_max</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the slider position.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grab_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_release_event&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drag_active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">release_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>

        <span class="c1"># determine which handle was grabbed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="n">handle_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">([</span><span class="n">h</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handle_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">([</span><span class="n">h</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">[</span><span class="n">handle_index</span><span class="p">]</span>

        <span class="c1"># these checks ensure smooth behavior if the handles swap which one</span>
        <span class="c1"># has a higher value. i.e. if one is dragged over and past the other.</span>
        <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="n">handle</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_val_from_pos</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_val_from_pos</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pretty-print *val*.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valfmt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valfmt</span> <span class="o">%</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valfmt</span> <span class="o">%</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">format_ticks</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">valmin</span><span class="p">,</span> <span class="o">*</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valmax</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># fmt.get_offset is actually the multiplicative factor, if any.</span>
            <span class="n">s1</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">get_offset</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmt</span><span class="o">.</span><span class="n">get_offset</span><span class="p">()</span>
            <span class="c1"># Use f string to avoid issues with backslashes when cast to a str</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">s1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">s2</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">set_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the lower value of the slider to *min*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        min : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">((</span><span class="nb">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">set_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the lower value of the slider to *max*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        max : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_val</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set slider value to *val*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : tuple or array-like of float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_shape</span><span class="p">((</span><span class="mi">2</span><span class="p">,),</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_in_bounds</span><span class="p">(</span><span class="n">vmin</span><span class="p">)</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_in_bounds</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection_poly</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">([</span><span class="n">vmin</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">([</span><span class="n">vmax</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">([</span><span class="n">vmin</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">([</span><span class="n">vmax</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">valtext</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">((</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;changed&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect *func* as callback function to changes of the slider value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Function to call when slider is changed. The function</span>
<span class="sd">            must accept a numpy array with shape (2,) as its argument.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Connection id (which can be used to disconnect *func*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;changed&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">CheckButtons</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GUI neutral set of check buttons.</span>

<span class="sd">    For the check buttons to remain responsive you must keep a</span>
<span class="sd">    reference to this object.</span>

<span class="sd">    Connect to the CheckButtons with the `.on_clicked` method.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>
<span class="sd">    labels : list of `.Text`</span>

<span class="sd">    rectangles : list of `.Rectangle`</span>

<span class="sd">    lines : list of (`.Line2D`, `.Line2D`) pairs</span>
<span class="sd">        List of lines for the x&#39;s in the check boxes.  These lines exist for</span>
<span class="sd">        each box, but have ``set_visible(False)`` when its box is not checked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">actives</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add check buttons to `matplotlib.axes.Axes` instance *ax*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`</span>
<span class="sd">            The parent Axes for the widget.</span>

<span class="sd">        labels : list of str</span>
<span class="sd">            The labels of the check buttons.</span>

<span class="sd">        actives : list of bool, optional</span>
<span class="sd">            The initial check states of the buttons. The list must have the</span>
<span class="sd">            same length as *labels*. If not given, all buttons are unchecked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">actives</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">actives</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>

        <span class="n">axcolor</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">lineparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
                      <span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="s1">&#39;solid_capstyle&#39;</span><span class="p">:</span> <span class="s1">&#39;butt&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">active</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">actives</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="n">axcolor</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

            <span class="n">l1</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="o">**</span><span class="n">lineparams</span><span class="p">)</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">],</span> <span class="o">**</span><span class="n">lineparams</span><span class="p">)</span>

            <span class="n">l1</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
            <span class="n">l2</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">CallbackRegistry</span><span class="p">(</span><span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;clicked&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rectangles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle (activate or deactivate) a check button by index.</span>

<span class="sd">        Callbacks will be triggered if :attr:`eventson` is True.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index of the check button to toggle.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If *index* is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid CheckButton index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">l1</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="ow">not</span> <span class="n">l1</span><span class="o">.</span><span class="n">get_visible</span><span class="p">())</span>
        <span class="n">l2</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="ow">not</span> <span class="n">l2</span><span class="o">.</span><span class="n">get_visible</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;clicked&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a tuple of the status (True/False) of all of the check buttons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">l1</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="k">for</span> <span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect the callback function *func* to button click events.</span>

<span class="sd">        Returns a connection id, which can be used to disconnect the callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;clicked&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the observer with connection id *cid*.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TextBox</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GUI neutral text input box.</span>

<span class="sd">    For the text box to remain responsive you must keep a reference to it.</span>

<span class="sd">    Call `.on_text_change` to be updated whenever the text changes.</span>

<span class="sd">    Call `.on_submit` to be updated whenever the user hits enter or</span>
<span class="sd">    leaves the text entry field.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>
<span class="sd">    label : `.Text`</span>

<span class="sd">    color : color</span>
<span class="sd">        The color of the text box when not hovering.</span>
<span class="sd">    hovercolor : color</span>
<span class="sd">        The color of the text box when hovering.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DIST_FROM_LEFT</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;.95&#39;</span><span class="p">,</span> <span class="n">hovercolor</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">label_pad</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span>
                 <span class="n">textalignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`</span>
<span class="sd">            The `~.axes.Axes` instance the button will be placed into.</span>
<span class="sd">        label : str</span>
<span class="sd">            Label for this text box.</span>
<span class="sd">        initial : str</span>
<span class="sd">            Initial value in the text box.</span>
<span class="sd">        color : color</span>
<span class="sd">            The color of the box.</span>
<span class="sd">        hovercolor : color</span>
<span class="sd">            The color of the box when the mouse is over it.</span>
<span class="sd">        label_pad : float</span>
<span class="sd">            The distance between the label and the right side of the textbox.</span>
<span class="sd">        textalignment : {&#39;left&#39;, &#39;center&#39;, &#39;right&#39;}</span>
<span class="sd">            The horizontal location of the text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_DIST_FROM_LEFT</span> <span class="o">=</span> <span class="mf">.05</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_text_position</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">check_getitem</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">},</span>
            <span class="n">textalignment</span><span class="o">=</span><span class="n">textalignment</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="o">-</span><span class="n">label_pad</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

        <span class="c1"># TextBox&#39;s text object should not parse mathtext at all.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_text_position</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">textalignment</span><span class="p">,</span>
            <span class="n">parse_math</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">CallbackRegistry</span><span class="p">(</span><span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;submit&quot;</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># s.t. cursor appears from first click.</span>
            <span class="n">navigate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_click</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keypress</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;resize_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hovercolor</span> <span class="o">=</span> <span class="n">hovercolor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">capturekeystrokes</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rendercursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this is a hack to figure out where the cursor should go.</span>
        <span class="c1"># we draw the text up to where the cursor should go, measure</span>
        <span class="c1"># and save its dimensions, draw the real text, then put the cursor</span>
        <span class="c1"># at the saved dimensions</span>

        <span class="c1"># This causes a single extra draw if the figure has never been rendered</span>
        <span class="c1"># yet, which should be fine as we&#39;re going to repeatedly re-render the</span>
        <span class="c1"># figure later anyways.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_get_renderer</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># Save value before overwriting it.</span>
        <span class="n">widthtext</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">]</span>

        <span class="n">bb_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">widthtext</span> <span class="ow">or</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">bb_widthtext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">bb_text</span><span class="o">.</span><span class="n">y0</span> <span class="o">==</span> <span class="n">bb_text</span><span class="o">.</span><span class="n">y1</span><span class="p">:</span>  <span class="c1"># Restoring the height if no text.</span>
            <span class="n">bb_text</span><span class="o">.</span><span class="n">y0</span> <span class="o">-=</span> <span class="n">bb_widthtext</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bb_text</span><span class="o">.</span><span class="n">y1</span> <span class="o">+=</span> <span class="n">bb_widthtext</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">widthtext</span><span class="p">:</span>  <span class="c1"># Keep width to 0.</span>
            <span class="n">bb_text</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="n">bb_text</span><span class="o">.</span><span class="n">x0</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Move the cursor using width of bb_widthtext.</span>
            <span class="n">bb_text</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="n">bb_text</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="n">bb_widthtext</span><span class="o">.</span><span class="n">width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">segments</span><span class="o">=</span><span class="p">[[(</span><span class="n">bb_text</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">bb_text</span><span class="o">.</span><span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">bb_text</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">bb_text</span><span class="o">.</span><span class="n">y1</span><span class="p">)]],</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">release_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_keypress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capturekeystrokes</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span>
                        <span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;home&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;backspace&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                            <span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">:])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;delete&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">]</span> <span class="o">+</span>
                            <span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rendercursor</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;enter&quot;</span><span class="p">,</span> <span class="s2">&quot;return&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">newval</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">newval</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">newval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rendercursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">begin_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capturekeystrokes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Disable keypress shortcuts, which may otherwise cause the figure to</span>
        <span class="c1"># be saved, closed, etc., until the user stops typing.  The way to</span>
        <span class="c1"># achieve this depends on whether toolmanager is in use.</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">ExitStack</span><span class="p">()</span>  <span class="c1"># Register cleanup actions when user stops typing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_stop_typing</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">close</span>
        <span class="n">toolmanager</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="p">,</span> <span class="s2">&quot;toolmanager&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toolmanager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If using toolmanager, lock keypresses, and plan to release the</span>
            <span class="c1"># lock when typing stops.</span>
            <span class="n">toolmanager</span><span class="o">.</span><span class="n">keypresslock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">keypresslock</span><span class="o">.</span><span class="n">release</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If not using toolmanager, disable all keypress-related rcParams.</span>
            <span class="c1"># Avoid spurious warnings if keymaps are getting deprecated.</span>
            <span class="k">with</span> <span class="n">_api</span><span class="o">.</span><span class="n">suppress_matplotlib_deprecation_warning</span><span class="p">():</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rc_context</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;keymap.&quot;</span><span class="p">)}))</span>

    <span class="k">def</span> <span class="nf">stop_typing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capturekeystrokes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_stop_typing</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_stop_typing</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">notifysubmit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">notifysubmit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capturekeystrokes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">notifysubmit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="c1"># Because process() might throw an error in the user&#39;s code, only</span>
            <span class="c1"># call it once we&#39;ve already done our cleanup.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">position_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># now, we have to figure out where the cursor goes.</span>
        <span class="c1"># approximate it based on assuming all characters the same length</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_disp</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">bb</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rendercursor</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_typing</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">grab_mouse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capturekeystrokes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">begin_typing</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_cursor</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_typing</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hovercolor</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">colors</span><span class="o">.</span><span class="n">same_color</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_text_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the text changes, call this *func* with event.</span>

<span class="sd">        A connection id is returned which can be used to disconnect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the user hits enter or leaves the submission box, call this</span>
<span class="sd">        *func* with event.</span>

<span class="sd">        A connection id is returned which can be used to disconnect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">text</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the observer with connection id *cid*.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RadioButtons</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GUI neutral radio button.</span>

<span class="sd">    For the buttons to remain responsive you must keep a reference to this</span>
<span class="sd">    object.</span>

<span class="sd">    Connect to the RadioButtons with the `.on_clicked` method.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>
<span class="sd">    activecolor : color</span>
<span class="sd">        The color of the selected button.</span>
<span class="sd">    labels : list of `.Text`</span>
<span class="sd">        The button labels.</span>
<span class="sd">    circles : list of `~.patches.Circle`</span>
<span class="sd">        The buttons.</span>
<span class="sd">    value_selected : str</span>
<span class="sd">        The label text of the currently selected button.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">activecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add radio buttons to an `~.axes.Axes`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : `~matplotlib.axes.Axes`</span>
<span class="sd">            The Axes to add the buttons to.</span>
<span class="sd">        labels : list of str</span>
<span class="sd">            The button labels.</span>
<span class="sd">        active : int</span>
<span class="sd">            The index of the initially selected button.</span>
<span class="sd">        activecolor : color</span>
<span class="sd">            The color of the selected button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activecolor</span> <span class="o">=</span> <span class="n">activecolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_selected</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axcolor</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>

        <span class="c1"># scale the radius of the circle with the spacing between each one</span>
        <span class="n">circle_radius</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.01</span>
        <span class="c1"># default to hard-coded value if the radius becomes too large</span>
        <span class="n">circle_radius</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">circle_radius</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="n">active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_selected</span> <span class="o">=</span> <span class="n">label</span>
                <span class="n">facecolor</span> <span class="o">=</span> <span class="n">activecolor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">facecolor</span> <span class="o">=</span> <span class="n">axcolor</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">circle_radius</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                       <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">circles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">CallbackRegistry</span><span class="p">(</span><span class="n">signals</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;clicked&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">pclicked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pclicked</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">center</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">.</span><span class="n">radius</span><span class="p">):</span>
                <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pclicked</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">closest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">distances</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="n">closest</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select button with number *index*.</span>

<span class="sd">        Callbacks will be triggered if :attr:`eventson` is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid RadioButton index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circles</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activecolor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventson</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;clicked&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect the callback function *func* to button click events.</span>

<span class="sd">        Returns a connection id, which can be used to disconnect the callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;clicked&#39;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the observer with connection id *cid*.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SubplotTool</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tool to adjust the subplot params of a `matplotlib.figure.Figure`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetfig</span><span class="p">,</span> <span class="n">toolfig</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        targetfig : `.Figure`</span>
<span class="sd">            The figure instance to adjust.</span>
<span class="sd">        toolfig : `.Figure`</span>
<span class="sd">            The figure instance to embed the subplot tool into.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">toolfig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetfig</span> <span class="o">=</span> <span class="n">targetfig</span>
        <span class="n">toolfig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="n">toolfig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Click on slider to adjust subplot param&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sliders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;wspace&quot;</span><span class="p">,</span> <span class="s2">&quot;hspace&quot;</span><span class="p">]</span>
        <span class="c1"># The last subplot, removed below, keeps space for the &quot;Reset&quot; button.</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">toolfig</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">slider</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">targetfig</span><span class="o">.</span><span class="n">subplotpars</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_slider_changed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sliders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slider</span><span class="p">)</span>
        <span class="n">toolfig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderleft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderbottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidertop</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">sliderwspace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderhspace</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sliders</span>
        <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderleft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderbottom</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">sliderwspace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderhspace</span><span class="p">]:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">closedmax</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sliderright</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidertop</span><span class="p">]:</span>
            <span class="n">slider</span><span class="o">.</span><span class="n">closedmin</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderleft</span><span class="o">.</span><span class="n">slidermax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderright</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderright</span><span class="o">.</span><span class="n">slidermin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderleft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderbottom</span><span class="o">.</span><span class="n">slidermax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slidertop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slidertop</span><span class="o">.</span><span class="n">slidermin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sliderbottom</span>

        <span class="n">bax</span> <span class="o">=</span> <span class="n">toolfig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonreset</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">bax</span><span class="p">,</span> <span class="s1">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonreset</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_reset</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_slider_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetfig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span><span class="n">slider</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">():</span> <span class="n">slider</span><span class="o">.</span><span class="n">val</span>
               <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sliders</span><span class="p">})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targetfig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
            <span class="c1"># Temporarily disable drawing on self and self&#39;s sliders, and</span>
            <span class="c1"># disconnect slider events (as the subplotparams can be temporarily</span>
            <span class="c1"># invalid, depending on the order in which they are restored).</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawon</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sliders</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span>
                    <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="n">drawon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eventson</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
            <span class="c1"># Reset the slider to the initial position.</span>
            <span class="k">for</span> <span class="n">slider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sliders</span><span class="p">:</span>
                <span class="n">slider</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawon</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>  <span class="c1"># Redraw the subplottool canvas.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_slider_changed</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Apply changes to the target window.</span>


<span class="k">class</span> <span class="nc">Cursor</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A crosshair cursor that spans the Axes and moves with mouse cursor.</span>

<span class="sd">    For the cursor to remain responsive you must keep a reference to it.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `matplotlib.axes.Axes`</span>
<span class="sd">        The `~.axes.Axes` to attach the cursor to.</span>
<span class="sd">    horizOn : bool, default: True</span>
<span class="sd">        Whether to draw the horizontal line.</span>
<span class="sd">    vertOn : bool, default: True</span>
<span class="sd">        Whether to draw the vertical line.</span>
<span class="sd">    useblit : bool, default: False</span>
<span class="sd">        Use blitting for faster drawing if supported by the backend.</span>
<span class="sd">        See the tutorial :doc:`/tutorials/advanced/blitting` for details.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    **lineprops</span>
<span class="sd">        `.Line2D` properties that control the appearance of the lines.</span>
<span class="sd">        See also `~.Axes.axhline`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    See :doc:`/gallery/widgets/cursor`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">horizOn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vertOn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">lineprops</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onmove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizOn</span> <span class="o">=</span> <span class="n">horizOn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertOn</span> <span class="o">=</span> <span class="n">vertOn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span> <span class="o">=</span> <span class="n">useblit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">supports_blit</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="n">lineprops</span><span class="p">[</span><span class="s1">&#39;animated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">lineprops</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linev</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">lineprops</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needclear</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal event handler to clear the cursor.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linev</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal event handler to draw the cursor when the mouse moves.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linev</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">needclear</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">needclear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needclear</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linev</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linev</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertOn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizOn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linev</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">MultiCursor</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide a vertical (default) and/or horizontal line cursor shared between</span>
<span class="sd">    multiple Axes.</span>

<span class="sd">    For the cursor to remain responsive you must keep a reference to it.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    canvas : object</span>
<span class="sd">        This parameter is entirely unused and only kept for back-compatibility.</span>

<span class="sd">    axes : list of `matplotlib.axes.Axes`</span>
<span class="sd">        The `~.axes.Axes` to attach the cursor to.</span>

<span class="sd">    useblit : bool, default: True</span>
<span class="sd">        Use blitting for faster drawing if supported by the backend.</span>
<span class="sd">        See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>

<span class="sd">    horizOn : bool, default: False</span>
<span class="sd">        Whether to draw the horizontal line.</span>

<span class="sd">    vertOn : bool, default: True</span>
<span class="sd">        Whether to draw the vertical line.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    **lineprops</span>
<span class="sd">        `.Line2D` properties that control the appearance of the lines.</span>
<span class="sd">        See also `~.Axes.axhline`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    See :doc:`/gallery/widgets/multicursor`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">make_keyword_only</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="s2">&quot;useblit&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">horizOn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vertOn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">lineprops</span><span class="p">):</span>
        <span class="c1"># canvas is stored only to provide the deprecated .canvas attribute;</span>
        <span class="c1"># once it goes away the unused argument won&#39;t need to be stored at all.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_canvas</span> <span class="o">=</span> <span class="n">canvas</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizOn</span> <span class="o">=</span> <span class="n">horizOn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertOn</span> <span class="o">=</span> <span class="n">vertOn</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;cids&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;background&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">}</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">xmid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">ymid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">useblit</span>
            <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">supports_blit</span> <span class="k">for</span> <span class="n">canvas</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needclear</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="n">lineprops</span><span class="p">[</span><span class="s1">&#39;animated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">vertOn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">xmid</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">lineprops</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vlines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">horizOn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ymid</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">lineprops</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hlines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">)</span>
    <span class="n">background</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">)(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backgrounds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect events.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onmove</span><span class="p">),</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">),</span>
            <span class="p">]</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disconnect events.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cids&quot;</span><span class="p">]:</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the cursor.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vlines</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needclear</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertOn</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vlines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">))</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizOn</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlines</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">]:</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertOn</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vlines</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">horizOn</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlines</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">canvas</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="p">:</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">canvas</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canvas_infos</span><span class="p">:</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_SelectorWidget</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">button</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">state_modifier_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_data_coordinates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span> <span class="o">=</span> <span class="n">onselect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span> <span class="o">=</span> <span class="n">useblit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">supports_blit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_default_events</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">move</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="s1">&#39;escape&#39;</span><span class="p">,</span>
                                         <span class="n">square</span><span class="o">=</span><span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="s1">&#39;control&#39;</span><span class="p">,</span>
                                         <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state_modifier_keys</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_data_coordinates</span> <span class="o">=</span> <span class="n">use_data_coordinates</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validButtons</span> <span class="o">=</span> <span class="p">[</span><span class="n">button</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validButtons</span> <span class="o">=</span> <span class="n">button</span>

        <span class="c1"># Set to True when a selection is completed, otherwise is False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># will save the data (position at mouseclick)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># will save the data (pos. at mouserelease)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">eventpress</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>
    <span class="n">eventrelease</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>
    <span class="n">state_modifier_keys</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_background</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_animated_artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method to get all animated artists of the figure containing</span>
<span class="sd">        this widget, excluding those already present in self.artists.</span>
<span class="sd">        The returned tuple is not sorted by &#39;z_order&#39;: z_order sorting is</span>
<span class="sd">        valid only when considering all artists and not only a subset of all</span>
<span class="sd">        artists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
                     <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax_</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
                     <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get_animated</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artists</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Force an update of the background.&quot;&quot;&quot;</span>
        <span class="c1"># If you add a call to `ignore` here, you&#39;ll want to check edge case:</span>
        <span class="c1"># `release` can call a draw event even when `ignore` is True.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Make sure that widget artists don&#39;t get accidentally included in the</span>
        <span class="c1"># background, by re-rendering the background if needed (and then</span>
        <span class="c1"># re-re-rendering the canvas with the visible widget artists).</span>
        <span class="c1"># We need to remove all artists which will be drawn when updating</span>
        <span class="c1"># the selector: if we have animated artists in the figure, it is safer</span>
        <span class="c1"># to redrawn by default, in case they have updated by the callback</span>
        <span class="c1"># zorder needs to be respected when redrawing</span>
        <span class="n">artists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artists</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_animated_artists</span><span class="p">(),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">get_zorder</span><span class="p">())</span>
        <span class="n">needs_redraw</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">artist</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">needs_redraw</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">artist</span><span class="o">.</span><span class="n">_cm_set</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">needs_redraw</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_default_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Connect the major canvas events to methods.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onmove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">press</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;draw_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_background</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_key_press</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;key_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_key_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;scroll_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_scroll</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ignore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c1"># docstring inherited</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># If canvas was locked</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;button&#39;</span><span class="p">):</span>
            <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Only do rectangle selection if event was triggered</span>
        <span class="c1"># with a desired button</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validButtons</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validButtons</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># If no button was pressed yet ignore the event if it was out</span>
        <span class="c1"># of the Axes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span>
        <span class="c1"># If a button was pressed, check if the release-button is the same.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">button</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># If a button was pressed, check if the release-button is the same.</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="ow">or</span>
                <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">button</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw using blit() or draw_idle(), depending on ``self.useblit``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_get_renderer</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_background</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># We need to draw all artists, which are not included in the</span>
            <span class="c1"># background, therefore we also draw self._get_animated_artists()</span>
            <span class="c1"># and we make sure that we respect z_order</span>
            <span class="n">artists</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artists</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_animated_artists</span><span class="p">(),</span>
                             <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">get_zorder</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the xdata and ydata for event, with limits.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">())</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span>

    <span class="k">def</span> <span class="nf">_clean_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocess an event:</span>

<span class="sd">        - Replace *event* by the previous event if *event* has no ``xdata``.</span>
<span class="sd">        - Clip ``xdata`` and ``ydata`` to the axes limits.</span>
<span class="sd">        - Update the previous event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_event</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_event</span> <span class="o">=</span> <span class="n">event</span>
        <span class="k">return</span> <span class="n">event</span>

    <span class="k">def</span> <span class="nf">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button press handler and validator.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span> <span class="o">=</span> <span class="n">event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_event</span> <span class="o">=</span> <span class="n">event</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ctrl&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)</span>
            <span class="c1"># move state is locked in on a button press</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="p">[</span><span class="s1">&#39;move&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_press</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button press event handler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button release event handler and validator.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span> <span class="o">=</span> <span class="n">event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button release event handler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cursor move event handler and validator.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onmove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cursor move event handler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_scroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mouse scroll event handler and validator.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_scroll</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_scroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mouse scroll event handler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Key press event handler and validator for all selection widgets.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ctrl&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="p">[</span><span class="s1">&#39;clear&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">):</span>
                    <span class="c1"># &#39;rotate&#39; is changing _state on press and is not removed</span>
                    <span class="c1"># from _state when releasing</span>
                    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;rotate&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_key_press</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Key press event handler - for widget-specific key press actions.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">on_key_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Key release event handler and validator.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># &#39;rotate&#39; is changing _state on press and is not removed</span>
                <span class="c1"># from _state when releasing</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;rotate&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_key_release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_key_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Key release event handler.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the visibility of the selector artists.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="n">visible</span>
        <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artists</span><span class="p">:</span>
            <span class="n">artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the visibility of the selector artists.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">visible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>

    <span class="nd">@visible</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">):</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;set_visible&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the selection and set the selector ready to make a new one.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_without_update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_clear_without_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tuple of the artists of the selector.&quot;&quot;&quot;</span>
        <span class="n">handles_artists</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_handles_artists&#39;</span><span class="p">,</span> <span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="p">,)</span> <span class="o">+</span> <span class="n">handles_artists</span>

    <span class="k">def</span> <span class="nf">set_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the properties of the selector artist. See the `props` argument</span>
<span class="sd">        in the selector docstring to know which properties are supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">artist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">normalize_kwargs</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">artist</span><span class="p">)</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">props</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_handle_props</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">handle_props</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the properties of the handles selector artist. See the</span>
<span class="sd">        `handle_props` argument in the selector docstring to know which</span>
<span class="sd">        properties are supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_handles_artists&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This selector doesn&#39;t have handles.&quot;</span><span class="p">)</span>

        <span class="n">artist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles_artists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">handle_props</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">normalize_kwargs</span><span class="p">(</span><span class="n">handle_props</span><span class="p">,</span> <span class="n">artist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handles_artists</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">handle_props</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">handle_props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">supported_state</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;clear&#39;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;not-applicable&#39;</span>
            <span class="p">]</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">(</span><span class="n">supported_state</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a state to define the widget&#39;s behavior. See the</span>
<span class="sd">        `state_modifier_keys` parameters for details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        state : str</span>
<span class="sd">            Must be a supported state of the selector. See the</span>
<span class="sd">            `state_modifier_keys` parameters for details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            When the state is not supported by the selector.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a state to define the widget&#39;s behavior. See the</span>
<span class="sd">        `state_modifier_keys` parameters for details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            Must be a supported state of the selector. See the</span>
<span class="sd">            `state_modifier_keys` parameters for details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            When the state is not supported by the selector.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SpanSelector</span><span class="p">(</span><span class="n">_SelectorWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visually select a min/max range on a single axis and call a function with</span>
<span class="sd">    those values.</span>

<span class="sd">    To guarantee that the selector remains responsive, keep a reference to it.</span>

<span class="sd">    In order to turn off the SpanSelector, set ``span_selector.active`` to</span>
<span class="sd">    False.  To turn it back on, set it to True.</span>

<span class="sd">    Press and release events triggered at the same coordinates outside the</span>
<span class="sd">    selection will clear the selector, except when</span>
<span class="sd">    ``ignore_event_outside=True``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `matplotlib.axes.Axes`</span>

<span class="sd">    onselect : callable</span>
<span class="sd">        A callback function that is called after a release event and the</span>
<span class="sd">        selection is created, changed or removed.</span>
<span class="sd">        It must have the signature::</span>

<span class="sd">            def on_select(min: float, max: float) -&gt; Any</span>

<span class="sd">    direction : {&quot;horizontal&quot;, &quot;vertical&quot;}</span>
<span class="sd">        The direction along which to draw the span selector.</span>

<span class="sd">    minspan : float, default: 0</span>
<span class="sd">        If selection is less than or equal to *minspan*, the selection is</span>
<span class="sd">        removed (when already existing) or cancelled.</span>

<span class="sd">    useblit : bool, default: False</span>
<span class="sd">        If True, use the backend-dependent blitting features for faster</span>
<span class="sd">        canvas updates. See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>

<span class="sd">    props : dict, optional</span>
<span class="sd">        Dictionary of `matplotlib.patches.Patch` properties.</span>
<span class="sd">        Default:</span>

<span class="sd">            ``dict(facecolor=&#39;red&#39;, alpha=0.5)``</span>

<span class="sd">    onmove_callback : func(min, max), min/max are floats, default: None</span>
<span class="sd">        Called on mouse move while the span is being selected.</span>

<span class="sd">    span_stays : bool, default: False</span>
<span class="sd">        If True, the span stays visible after the mouse is released.</span>
<span class="sd">        Deprecated, use *interactive* instead.</span>

<span class="sd">    interactive : bool, default: False</span>
<span class="sd">        Whether to draw a set of handles that allow interaction with the</span>
<span class="sd">        widget after it is drawn.</span>

<span class="sd">    button : `.MouseButton` or list of `.MouseButton`, default: all buttons</span>
<span class="sd">        The mouse buttons which activate the span selector.</span>

<span class="sd">    handle_props : dict, default: None</span>
<span class="sd">        Properties of the handle lines at the edges of the span. Only used</span>
<span class="sd">        when *interactive* is True. See `matplotlib.lines.Line2D` for valid</span>
<span class="sd">        properties.</span>

<span class="sd">    grab_range : float, default: 10</span>
<span class="sd">        Distance in pixels within which the interactive tool handles can be</span>
<span class="sd">        activated.</span>

<span class="sd">    state_modifier_keys : dict, optional</span>
<span class="sd">        Keyboard modifiers which affect the widget&#39;s behavior.  Values</span>
<span class="sd">        amend the defaults, which are:</span>

<span class="sd">        - &quot;clear&quot;: Clear the current shape, default: &quot;escape&quot;.</span>

<span class="sd">    drag_from_anywhere : bool, default: False</span>
<span class="sd">        If `True`, the widget can be moved by clicking anywhere within</span>
<span class="sd">        its bounds.</span>

<span class="sd">    ignore_event_outside : bool, default: False</span>
<span class="sd">        If `True`, the event triggered outside the span selector will be</span>
<span class="sd">        ignored.</span>

<span class="sd">    snap_values : 1D array-like, optional</span>
<span class="sd">        Snap the selector edges to the given values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.widgets as mwidgets</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot([1, 2, 3], [10, 50, 100])</span>
<span class="sd">    &gt;&gt;&gt; def onselect(vmin, vmax):</span>
<span class="sd">    ...     print(vmin, vmax)</span>
<span class="sd">    &gt;&gt;&gt; span = mwidgets.SpanSelector(ax, onselect, &#39;horizontal&#39;,</span>
<span class="sd">    ...                              props=dict(facecolor=&#39;blue&#39;, alpha=0.5))</span>
<span class="sd">    &gt;&gt;&gt; fig.show()</span>

<span class="sd">    See also: :doc:`/gallery/widgets/span_selector`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;rectprops&quot;</span><span class="p">,</span> <span class="s2">&quot;props&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;span_stays&quot;</span><span class="p">,</span> <span class="s2">&quot;interactive&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">minspan</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">onmove_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">button</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handle_props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grab_range</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">state_modifier_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drag_from_anywhere</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">ignore_event_outside</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">snap_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">state_modifier_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">state_modifier_keys</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="s1">&#39;escape&#39;</span><span class="p">,</span>
                                       <span class="n">square</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">,</span>
                                       <span class="n">center</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">,</span>
                                       <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="n">useblit</span><span class="p">,</span> <span class="n">button</span><span class="o">=</span><span class="n">button</span><span class="p">,</span>
                         <span class="n">state_modifier_keys</span><span class="o">=</span><span class="n">state_modifier_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;animated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snap_values</span> <span class="o">=</span> <span class="n">snap_values</span>

        <span class="c1"># self._pressv is deprecated and we don&#39;t use it internally anymore</span>
        <span class="c1"># but we maintain it until it is removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pressv</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onmove_callback</span> <span class="o">=</span> <span class="n">onmove_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minspan</span> <span class="o">=</span> <span class="n">minspan</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span> <span class="o">=</span> <span class="n">grab_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span> <span class="o">=</span> <span class="n">interactive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_from_anywhere</span> <span class="o">=</span> <span class="n">drag_from_anywhere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span> <span class="o">=</span> <span class="n">ignore_event_outside</span>

        <span class="c1"># Reset canvas so that `new_axes` connects events.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># Setup handles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;facecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span>
            <span class="o">**</span><span class="n">cbook</span><span class="o">.</span><span class="n">normalize_kwargs</span><span class="p">(</span><span class="n">handle_props</span><span class="p">,</span> <span class="n">Line2D</span><span class="p">)}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_edge_handles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># prev attribute is deprecated but we still need to maintain it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">rect</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">rectprops</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">active_handle</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="n">pressv</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="n">span_stays</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">prev</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set SpanSelector to operate on a new Axes.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_events</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_default_events</span><span class="p">()</span>

        <span class="c1"># Reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis_transform</span><span class="p">()</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis_transform</span><span class="p">()</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">rect_artist</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span>
                                <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect_artist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span> <span class="o">=</span> <span class="n">rect_artist</span>

    <span class="k">def</span> <span class="nf">_setup_edge_handles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="c1"># Define initial position using the axis bounds to keep the same bounds</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xbound</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span> <span class="o">=</span> <span class="n">ToolLineHandles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span>
                                             <span class="n">direction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span>
                                             <span class="n">line_props</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
                                             <span class="n">useblit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_handles_artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">artists</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the canvas cursor based on direction of the selector.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="p">(</span><span class="n">backend_tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">RESIZE_HORIZONTAL</span>
                      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span>
                      <span class="n">backend_tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">RESIZE_VERTICAL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">backend_tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">POINTER</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_default_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># docstring inherited</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">connect_default_events</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_interactive&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hover</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button press event handler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_cursor</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_active_handle</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="c1"># Clear previous rectangle before drawing new rectangle.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="c1"># self._pressv and self._prev are deprecated but we still need to</span>
        <span class="c1"># maintain them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pressv</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span><span class="p">:</span>
            <span class="c1"># when the press event outside the span, we initially set the</span>
            <span class="c1"># visibility to False and extents to (v, v)</span>
            <span class="c1"># update will be called when setting the extents</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extents</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span>
            <span class="c1"># We need to set the visibility back, so the span selector will be</span>
            <span class="c1"># drawn when necessary (span width &gt; 0)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Direction of the span selector: &#39;vertical&#39; or &#39;horizontal&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span>

    <span class="nd">@direction</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the direction of the span selector.&quot;&quot;&quot;</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">],</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_direction&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">direction</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">:</span>
            <span class="c1"># remove previous artists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="n">direction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_axes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setup_edge_handles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="n">direction</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button release event handler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_cursor</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># self._pressv is deprecated but we still need to maintain it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pressv</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extents</span>
        <span class="n">span</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span>

        <span class="k">if</span> <span class="n">span</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minspan</span><span class="p">:</span>
            <span class="c1"># Remove span and set self._selection_completed = False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
                <span class="c1"># Call onselect, only when the span is already existing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_hover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the canvas cursor if it&#39;s over a handle.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
            <span class="c1"># Do nothing if button is pressed and a handle is active, which may</span>
            <span class="c1"># occur with drag_from_anywhere=True.</span>
            <span class="c1"># Do nothing if selection is not completed, which occurs when</span>
            <span class="c1"># a selector has been cleared</span>
            <span class="k">return</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">e_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_cursor</span><span class="p">(</span><span class="n">e_dist</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Motion notify event handler.&quot;&quot;&quot;</span>

        <span class="c1"># self._prev are deprecated but we still need to maintain it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">vpress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">xdata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vpress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">ydata</span>

        <span class="c1"># move existing span</span>
        <span class="c1"># When &quot;dragging from anywhere&quot;, `self._active_handle` is set to &#39;C&#39;</span>
        <span class="c1"># (match notation used in the RectangleSelector)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">vpress</span>
            <span class="n">vmin</span> <span class="o">+=</span> <span class="n">dv</span>
            <span class="n">vmax</span> <span class="o">+=</span> <span class="n">dv</span>

        <span class="c1"># resize an existing shape</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">!=</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1"># new shape</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Don&#39;t create a new span if there is already one when</span>
            <span class="c1"># ignore_event_outside=True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vpress</span><span class="p">,</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">vmin</span> <span class="o">&gt;</span> <span class="n">vmax</span><span class="p">:</span>
                <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vmin</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extents</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onmove_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onmove_callback</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_draw_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="o">&gt;</span> <span class="n">vmax</span><span class="p">:</span>
            <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">vmin</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="n">vmin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">vmin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_active_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set active handle based on the location of the mouse event.&quot;&quot;&quot;</span>
        <span class="c1"># Note: event.xdata/ydata in data coordinates, event.x/y in pixels</span>
        <span class="n">e_idx</span><span class="p">,</span> <span class="n">e_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Prioritise center handle over other handles</span>
        <span class="c1"># Use &#39;C&#39; to match the notation used in the RectangleSelector</span>
        <span class="k">if</span> <span class="s1">&#39;move&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">elif</span> <span class="n">e_dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">:</span>
            <span class="c1"># Not close to any handles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_from_anywhere</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="c1"># Check if we&#39;ve clicked inside the region</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extents</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Closest to an edge handle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_order</span><span class="p">[</span><span class="n">e_idx</span><span class="p">]</span>

        <span class="c1"># Save coordinates of rectangle at the start of handle movement.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extents</span>

    <span class="k">def</span> <span class="nf">_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if event is within the patch.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_snap</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">snap_values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Snap values to a given array values (snap_values).&quot;&quot;&quot;</span>
        <span class="c1"># take into account machine precision</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">snap_values</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">1e-12</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="n">snap_values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">snap_values</span> <span class="o">-</span> <span class="n">v</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">eps</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return extents of the span selector.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span>

    <span class="nd">@extents</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">extents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extents</span><span class="p">):</span>
        <span class="c1"># Update displayed shape</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extents</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_snap</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_values</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_shape</span><span class="p">(</span><span class="o">*</span><span class="n">extents</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="c1"># Update displayed handles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ToolLineHandles</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control handles for canvas tools.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `matplotlib.axes.Axes`</span>
<span class="sd">        Matplotlib Axes where tool handles are displayed.</span>
<span class="sd">    positions : 1D array</span>
<span class="sd">        Positions of handles in data coordinates.</span>
<span class="sd">    direction : {&quot;horizontal&quot;, &quot;vertical&quot;}</span>
<span class="sd">        Direction of handles, either &#39;vertical&#39; or &#39;horizontal&#39;</span>
<span class="sd">    line_props : dict, optional</span>
<span class="sd">        Additional line properties. See `matplotlib.lines.Line2D`.</span>
<span class="sd">    useblit : bool, default: True</span>
<span class="sd">        Whether to use blitting for faster drawing (if supported by the</span>
<span class="sd">        backend). See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">line_props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>

        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">],</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span> <span class="o">=</span> <span class="n">direction</span>

        <span class="k">if</span> <span class="n">line_props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">line_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">line_props</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;animated&#39;</span><span class="p">:</span> <span class="n">useblit</span><span class="p">})</span>

        <span class="n">line_fun</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_artists</span> <span class="o">=</span> <span class="p">[</span><span class="n">line_fun</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">**</span><span class="n">line_props</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_artists</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Positions of the handle in data coordinates.&quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;get_xdata&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span> <span class="s1">&#39;get_ydata&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">method</span><span class="p">)()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artists</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Direction of the handle: &#39;vertical&#39; or &#39;horizontal&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set x or y positions of handles, depending if the lines are vertical</span>
<span class="sd">        of horizontal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        positions : tuple of length 2</span>
<span class="sd">            Set the positions of the handle in data coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;set_xdata&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span> <span class="s1">&#39;set_ydata&#39;</span>
        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">artists</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">method</span><span class="p">)([</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the visibility state of the handles artist.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artists</span><span class="p">:</span>
            <span class="n">artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_animated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the animated state of the handles artist.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">artists</span><span class="p">:</span>
            <span class="n">artist</span><span class="o">.</span><span class="n">set_animated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the handles artist from the figure.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_artists</span><span class="p">:</span>
            <span class="n">artist</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">closest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return index and pixel distance to closest handle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : float</span>
<span class="sd">            x, y position from which the distance will be calculated to</span>
<span class="sd">            determinate the closest handle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index, distance : index of the handle and its distance from</span>
<span class="sd">            position x, y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">p_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span>
                <span class="p">])</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p_pts</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span>
                <span class="p">])</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p_pts</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ToolHandles</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control handles for canvas tools.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `matplotlib.axes.Axes`</span>
<span class="sd">        Matplotlib Axes where tool handles are displayed.</span>
<span class="sd">    x, y : 1D arrays</span>
<span class="sd">        Coordinates of control handles.</span>
<span class="sd">    marker : str, default: &#39;o&#39;</span>
<span class="sd">        Shape of marker used to display handle. See `matplotlib.pyplot.plot`.</span>
<span class="sd">    marker_props : dict, optional</span>
<span class="sd">        Additional marker properties. See `matplotlib.lines.Line2D`.</span>
<span class="sd">    useblit : bool, default: True</span>
<span class="sd">        Whether to use blitting for faster drawing (if supported by the</span>
<span class="sd">        backend). See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">marker_props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">cbook</span><span class="o">.</span><span class="n">normalize_kwargs</span><span class="p">(</span><span class="n">marker_props</span><span class="p">,</span> <span class="n">Line2D</span><span class="o">.</span><span class="n">_alias_map</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="n">useblit</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set x and y positions of handles.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">pts</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_animated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="o">.</span><span class="n">set_animated</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">closest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return index and pixel distance to closest index.&quot;&quot;&quot;</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">])</span>
        <span class="c1"># Transform data coordinates to pixel coordinates.</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">-</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="o">*</span><span class="n">diff</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">min_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">min_index</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>


<span class="n">_RECTANGLESELECTOR_PARAMETERS_DOCSTRING</span> <span class="o">=</span> \
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent axes for the widget.</span>

<span class="sd">    onselect : function</span>
<span class="sd">        A callback function that is called after a release event and the</span>
<span class="sd">        selection is created, changed or removed.</span>
<span class="sd">        It must have the signature::</span>

<span class="sd">            def onselect(eclick: MouseEvent, erelease: MouseEvent)</span>

<span class="sd">        where *eclick* and *erelease* are the mouse click and release</span>
<span class="sd">        `.MouseEvent`\s that start and complete the selection.</span>

<span class="sd">    minspanx : float, default: 0</span>
<span class="sd">        Selections with an x-span less than or equal to *minspanx* are removed</span>
<span class="sd">        (when already existing) or cancelled.</span>

<span class="sd">    minspany : float, default: 0</span>
<span class="sd">        Selections with an y-span less than or equal to *minspanx* are removed</span>
<span class="sd">        (when already existing) or cancelled.</span>

<span class="sd">    useblit : bool, default: False</span>
<span class="sd">        Whether to use blitting for faster drawing (if supported by the</span>
<span class="sd">        backend). See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>

<span class="sd">    props : dict, optional</span>
<span class="sd">        Properties with which the __ARTIST_NAME__ is drawn. See</span>
<span class="sd">        `matplotlib.patches.Patch` for valid properties.</span>
<span class="sd">        Default:</span>

<span class="sd">        ``dict(facecolor=&#39;red&#39;, edgecolor=&#39;black&#39;, alpha=0.2, fill=True)``</span>

<span class="sd">    spancoords : {&quot;data&quot;, &quot;pixels&quot;}, default: &quot;data&quot;</span>
<span class="sd">        Whether to interpret *minspanx* and *minspany* in data or in pixel</span>
<span class="sd">        coordinates.</span>

<span class="sd">    button : `.MouseButton`, list of `.MouseButton`, default: all buttons</span>
<span class="sd">        Button(s) that trigger rectangle selection.</span>

<span class="sd">    grab_range : float, default: 10</span>
<span class="sd">        Distance in pixels within which the interactive tool handles can be</span>
<span class="sd">        activated.</span>

<span class="sd">    handle_props : dict, optional</span>
<span class="sd">        Properties with which the interactive handles (marker artists) are</span>
<span class="sd">        drawn. See the marker arguments in `matplotlib.lines.Line2D` for valid</span>
<span class="sd">        properties.  Default values are defined in ``mpl.rcParams`` except for</span>
<span class="sd">        the default value of ``markeredgecolor`` which will be the same as the</span>
<span class="sd">        ``edgecolor`` property in *props*.</span>

<span class="sd">    interactive : bool, default: False</span>
<span class="sd">        Whether to draw a set of handles that allow interaction with the</span>
<span class="sd">        widget after it is drawn.</span>

<span class="sd">    state_modifier_keys : dict, optional</span>
<span class="sd">        Keyboard modifiers which affect the widget&#39;s behavior.  Values</span>
<span class="sd">        amend the defaults, which are:</span>

<span class="sd">        - &quot;move&quot;: Move the existing shape, default: no modifier.</span>
<span class="sd">        - &quot;clear&quot;: Clear the current shape, default: &quot;escape&quot;.</span>
<span class="sd">        - &quot;square&quot;: Make the shape square, default: &quot;shift&quot;.</span>
<span class="sd">        - &quot;center&quot;: change the shape around its center, default: &quot;ctrl&quot;.</span>
<span class="sd">        - &quot;rotate&quot;: Rotate the shape around its center between -45° and 45°,</span>
<span class="sd">          default: &quot;r&quot;.</span>

<span class="sd">        &quot;square&quot; and &quot;center&quot; can be combined. The square shape can be defined</span>
<span class="sd">        in data or display coordinates as determined by the</span>
<span class="sd">        ``use_data_coordinates`` argument specified when creating the selector.</span>

<span class="sd">    drag_from_anywhere : bool, default: False</span>
<span class="sd">        If `True`, the widget can be moved by clicking anywhere within</span>
<span class="sd">        its bounds.</span>

<span class="sd">    ignore_event_outside : bool, default: False</span>
<span class="sd">        If `True`, the event triggered outside the span selector will be</span>
<span class="sd">        ignored.</span>

<span class="sd">    use_data_coordinates : bool, default: False</span>
<span class="sd">        If `True`, the &quot;square&quot; shape of the selector is defined in</span>
<span class="sd">        data coordinates instead of display coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="nd">@_docstring</span><span class="o">.</span><span class="n">Substitution</span><span class="p">(</span><span class="n">_RECTANGLESELECTOR_PARAMETERS_DOCSTRING</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s1">&#39;__ARTIST_NAME__&#39;</span><span class="p">,</span> <span class="s1">&#39;rectangle&#39;</span><span class="p">))</span>
<span class="k">class</span> <span class="nc">RectangleSelector</span><span class="p">(</span><span class="n">_SelectorWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select a rectangular region of an Axes.</span>

<span class="sd">    For the cursor to remain responsive you must keep a reference to it.</span>

<span class="sd">    Press and release events triggered at the same coordinates outside the</span>
<span class="sd">    selection will clear the selector, except when</span>
<span class="sd">    ``ignore_event_outside=True``.</span>

<span class="sd">    %s</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.widgets as mwidgets</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot([1, 2, 3], [10, 50, 100])</span>
<span class="sd">    &gt;&gt;&gt; def onselect(eclick, erelease):</span>
<span class="sd">    ...     print(eclick.xdata, eclick.ydata)</span>
<span class="sd">    ...     print(erelease.xdata, erelease.ydata)</span>
<span class="sd">    &gt;&gt;&gt; props = dict(facecolor=&#39;blue&#39;, alpha=0.5)</span>
<span class="sd">    &gt;&gt;&gt; rect = mwidgets.RectangleSelector(ax, onselect, interactive=True,</span>
<span class="sd">    ...                                   props=props)</span>
<span class="sd">    &gt;&gt;&gt; fig.show()</span>
<span class="sd">    &gt;&gt;&gt; rect.add_state(&#39;square&#39;)</span>

<span class="sd">    See also: :doc:`/gallery/widgets/rectangle_selector`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;maxdist&quot;</span><span class="p">,</span> <span class="s2">&quot;grab_range&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;marker_props&quot;</span><span class="p">,</span> <span class="s2">&quot;handle_props&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;rectprops&quot;</span><span class="p">,</span> <span class="s2">&quot;props&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">delete_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;drawtype&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">delete_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;lineprops&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">drawtype</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span>
                 <span class="n">minspanx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minspany</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">lineprops</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spancoords</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
                 <span class="n">button</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grab_range</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">handle_props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">state_modifier_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">drag_from_anywhere</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_event_outside</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">use_data_coordinates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="n">useblit</span><span class="p">,</span> <span class="n">button</span><span class="o">=</span><span class="n">button</span><span class="p">,</span>
                         <span class="n">state_modifier_keys</span><span class="o">=</span><span class="n">state_modifier_keys</span><span class="p">,</span>
                         <span class="n">use_data_coordinates</span><span class="o">=</span><span class="n">use_data_coordinates</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span> <span class="o">=</span> <span class="n">interactive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_from_anywhere</span> <span class="o">=</span> <span class="n">drag_from_anywhere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span> <span class="o">=</span> <span class="n">ignore_event_outside</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotation</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># State to allow the option of an interactive selector that can&#39;t be</span>
        <span class="c1"># interactively drawn. This is used in PolygonSelector as an</span>
        <span class="c1"># interactive bounding box to allow the polygon to be easily resized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_creation</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">drawtype</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>  <span class="c1"># draw a line but make it invisible</span>
            <span class="n">_api</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Support for drawtype=&#39;none&#39; is deprecated &quot;</span>
                               <span class="s2">&quot;since </span><span class="si">%(since)s</span><span class="s2"> and will be removed &quot;</span>
                               <span class="s2">&quot;</span><span class="si">%(removal)s</span><span class="s2">.&quot;</span>
                               <span class="s2">&quot;Use props=dict(visible=False) instead.&quot;</span><span class="p">)</span>
            <span class="n">drawtype</span> <span class="o">=</span> <span class="s1">&#39;line&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">drawtype</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">props</span><span class="p">[</span><span class="s1">&#39;animated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="o">=</span> <span class="n">props</span>
            <span class="n">to_draw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">to_draw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drawtype</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
            <span class="n">_api</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Support for drawtype=&#39;line&#39; is deprecated &quot;</span>
                               <span class="s2">&quot;since </span><span class="si">%(since)s</span><span class="s2"> and will be removed &quot;</span>
                               <span class="s2">&quot;</span><span class="si">%(removal)s</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lineprops</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lineprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                                 <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">lineprops</span><span class="p">[</span><span class="s1">&#39;animated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="o">=</span> <span class="n">lineprops</span>
            <span class="n">to_draw</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">to_draw</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span> <span class="o">=</span> <span class="n">to_draw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_aspect_ratio_correction</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minspanx</span> <span class="o">=</span> <span class="n">minspanx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minspany</span> <span class="o">=</span> <span class="n">minspany</span>

        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;pixels&#39;</span><span class="p">],</span> <span class="n">spancoords</span><span class="o">=</span><span class="n">spancoords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spancoords</span> <span class="o">=</span> <span class="n">spancoords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">=</span> <span class="n">drawtype</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span> <span class="o">=</span> <span class="n">grab_range</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;edgecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">),</span>
                <span class="o">**</span><span class="n">cbook</span><span class="o">.</span><span class="n">normalize_kwargs</span><span class="p">(</span><span class="n">handle_props</span><span class="p">,</span> <span class="n">Line2D</span><span class="p">)}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span> <span class="s1">&#39;SE&#39;</span><span class="p">,</span> <span class="s1">&#39;NE&#39;</span><span class="p">,</span> <span class="s1">&#39;NW&#39;</span><span class="p">]</span>
            <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corners</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_corner_handles</span> <span class="o">=</span> <span class="n">ToolHandles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span>
                                               <span class="n">marker_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="p">,</span>
                                               <span class="n">useblit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
            <span class="n">xe</span><span class="p">,</span> <span class="n">ye</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_centers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span> <span class="o">=</span> <span class="n">ToolHandles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">ye</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                                             <span class="n">marker_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="p">,</span>
                                             <span class="n">useblit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">)</span>

            <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_center_handle</span> <span class="o">=</span> <span class="n">ToolHandles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="p">[</span><span class="n">xc</span><span class="p">],</span> <span class="p">[</span><span class="n">yc</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                                              <span class="n">marker_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="p">,</span>
                                              <span class="n">useblit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">to_draw</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">drawtype</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="n">active_handle</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="n">interactive</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>

    <span class="n">maxdist</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;maxdist&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;grab_range&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">,</span>
                 <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;grab_range&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_handles_artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_center_handle</span><span class="o">.</span><span class="n">artists</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_corner_handles</span><span class="o">.</span><span class="n">artists</span><span class="p">,</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">artists</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">rotation_point</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button press event handler.&quot;&quot;&quot;</span>
        <span class="c1"># make the drawn box/line visible get the click-coordinates,</span>
        <span class="c1"># button, ...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_visible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_active_handle</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_allow_creation</span><span class="p">):</span>
            <span class="c1"># Clear previous rectangle before drawing new rectangle.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_allow_creation</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extents</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_on_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_aspect_ratio_correction</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button release event handler.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># update the eventpress and eventrelease with the resulting extents</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">y0</span>
        <span class="n">xy0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">x1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">y1</span>
        <span class="n">xy1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy1</span>

        <span class="c1"># calculate dimensions of box or line</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spancoords</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="n">spanx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
            <span class="n">spany</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">spancoords</span> <span class="o">==</span> <span class="s1">&#39;pixels&#39;</span><span class="p">:</span>
            <span class="n">spanx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">spany</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;pixels&#39;</span><span class="p">],</span>
                               <span class="n">spancoords</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">spancoords</span><span class="p">)</span>
        <span class="c1"># check if drawn distance (if it exists) is not too small in</span>
        <span class="c1"># either x or y-direction</span>
        <span class="n">minspanxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">spanx</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minspanx</span> <span class="ow">or</span> <span class="n">spany</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minspany</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span> <span class="ow">and</span> <span class="n">minspanxy</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
                <span class="c1"># Call onselect, only when the selection is already existing</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_without_update</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventrelease</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Motion notify event handler.</span>

<span class="sd">        This can do one of four things:</span>
<span class="sd">        - Translate</span>
<span class="sd">        - Rotate</span>
<span class="sd">        - Re-size</span>
<span class="sd">        - Continue the creation of a new shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eventpress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span>
        <span class="c1"># The calculations are done for rotation at zero: we apply inverse</span>
        <span class="c1"># transformation to events except when we rotate and move</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
        <span class="n">rotate</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;rotate&#39;</span> <span class="ow">in</span> <span class="n">state</span> <span class="ow">and</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">)</span>
        <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span>
        <span class="n">resize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">move</span>

        <span class="k">if</span> <span class="n">resize</span><span class="p">:</span>
            <span class="n">inv_tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rotation_transform</span><span class="p">()</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
            <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">inv_tr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
            <span class="n">eventpress</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">inv_tr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="p">[</span><span class="n">eventpress</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">ydata</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">xdata</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">ydata</span>
        <span class="c1"># refmax is used when moving the corner handle with the square state</span>
        <span class="c1"># and is the maximum between refx and refy</span>
        <span class="n">refmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_data_coordinates</span><span class="p">:</span>
            <span class="n">refx</span><span class="p">,</span> <span class="n">refy</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get dx/dy in display coordinates</span>
            <span class="n">refx</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">x</span>
            <span class="n">refy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">y</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span>
        <span class="c1"># rotate an existing shape</span>
        <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>
            <span class="c1"># calculate angle abc</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eventpress</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">])</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rotation_on_press</span> <span class="o">+</span> <span class="n">angle</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">resize</span><span class="p">:</span>
            <span class="n">size_on_press</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">]</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span> <span class="o">+</span> <span class="n">size_on_press</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">size_on_press</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Keeping the center fixed</span>
            <span class="k">if</span> <span class="s1">&#39;center&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="c1"># hh, hw are half-height and half-width</span>
                <span class="k">if</span> <span class="s1">&#39;square&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                    <span class="c1"># when using a corner, find which reference to use</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">:</span>
                        <span class="n">refmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">refy</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">refmax</span> <span class="o">==</span> <span class="n">refx</span><span class="p">:</span>
                        <span class="n">hw</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="n">hw</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">hw</span> <span class="o">=</span> <span class="n">hh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hw</span> <span class="o">=</span> <span class="n">size_on_press</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="n">size_on_press</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="c1"># cancel changes in perpendicular direction</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">:</span>
                        <span class="n">hw</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">:</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hw</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">hw</span><span class="p">,</span>
                                  <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">hh</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">hh</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># change sign of relative changes to simplify calculation</span>
                <span class="c1"># Switch variables so that x1 and/or y1 are updated on move</span>
                <span class="k">if</span> <span class="s1">&#39;W&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span><span class="p">:</span>
                    <span class="n">x0</span> <span class="o">=</span> <span class="n">x1</span>
                <span class="k">if</span> <span class="s1">&#39;S&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span><span class="p">:</span>
                    <span class="n">y0</span> <span class="o">=</span> <span class="n">y1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">:</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">:</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
                <span class="k">if</span> <span class="s1">&#39;square&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                    <span class="c1"># when using a corner, find which reference to use</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">:</span>
                        <span class="n">refmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">refy</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">refmax</span> <span class="o">==</span> <span class="n">refx</span><span class="p">:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span>
                        <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
                        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">*</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span>

        <span class="k">elif</span> <span class="n">move</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extents_on_press</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">xdata</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">ydata</span>
            <span class="n">x0</span> <span class="o">+=</span> <span class="n">dx</span>
            <span class="n">x1</span> <span class="o">+=</span> <span class="n">dx</span>
            <span class="n">y0</span> <span class="o">+=</span> <span class="n">dy</span>
            <span class="n">y1</span> <span class="o">+=</span> <span class="n">dy</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create a new shape</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rotation</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Don&#39;t create a new rectangle if there is already one when</span>
            <span class="c1"># ignore_event_outside=True</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_event_outside</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_creation</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">eventpress</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">eventpress</span><span class="o">.</span><span class="n">ydata</span><span class="p">]</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>

            <span class="c1"># square shape</span>
            <span class="k">if</span> <span class="s1">&#39;square&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">refmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">refx</span><span class="p">,</span> <span class="n">refy</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">refmax</span> <span class="o">==</span> <span class="n">refx</span><span class="p">:</span>
                    <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span>

            <span class="c1"># from center</span>
            <span class="k">if</span> <span class="s1">&#39;center&#39;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="n">dy</span> <span class="o">*=</span> <span class="mi">2</span>

            <span class="c1"># from corner</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dx</span>
                <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dy</span>

            <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span>
                              <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dy</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extents</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_rect_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span>

    <span class="k">def</span> <span class="nf">_set_aspect_ratio_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">_get_aspect_ratio</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="p">,</span> <span class="s1">&#39;_aspect_ratio_correction&#39;</span><span class="p">):</span>
            <span class="c1"># Aspect ratio correction is not supported with deprecated</span>
            <span class="c1"># drawtype=&#39;line&#39;. Remove this block in matplotlib 3.7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span> <span class="o">=</span> <span class="n">aspect_ratio</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_data_coordinates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_aspect_ratio_correction</span> <span class="o">=</span> <span class="n">aspect_ratio</span>

    <span class="k">def</span> <span class="nf">_get_rotation_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">_get_aspect_ratio</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rotation</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">)</span> \
                <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">corners</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Corners of rectangle in data coordinates from lower left,</span>
<span class="sd">        moving clockwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rect_bbox</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">x0</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rotation_transform</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">edge_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Midpoint of rectangle edges in data coordinates from left,</span>
<span class="sd">        moving anti-clockwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rect_bbox</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">xe</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">w</span>
        <span class="n">ye</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rotation_transform</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xe</span><span class="p">,</span> <span class="n">ye</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Center of rectangle in data coordinates.&quot;&quot;&quot;</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rect_bbox</span>
        <span class="k">return</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return (xmin, xmax, ymin, ymax) in data coordinates as defined by the</span>
<span class="sd">        bounding box before rotation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rect_bbox</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">width</span><span class="p">])</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">height</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span>

    <span class="nd">@extents</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">extents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extents</span><span class="p">):</span>
        <span class="c1"># Update displayed shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_shape</span><span class="p">(</span><span class="n">extents</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interactive</span><span class="p">:</span>
            <span class="c1"># Update displayed handles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_corner_handles</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">corners</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_centers</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_center_handle</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotation in degree in interval [-45°, 45°]. The rotation is limited in</span>
<span class="sd">        range to keep the implementation simple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rotation</span><span class="p">)</span>

    <span class="nd">@rotation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Restrict to a limited range of rotation [-45°, 45°] to avoid changing</span>
        <span class="c1"># order of handles</span>
        <span class="k">if</span> <span class="o">-</span><span class="mi">45</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">45</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rotation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="c1"># call extents setter to draw shape and update handles positions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extents</span>

    <span class="n">draw_shape</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s1">&#39;3.5&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extents</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">extents</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">])</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
        <span class="n">xlim</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>

        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmin</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ymin</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_active_handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set active handle based on the location of the mouse event.&quot;&quot;&quot;</span>
        <span class="c1"># Note: event.xdata/ydata in data coordinates, event.x/y in pixels</span>
        <span class="n">c_idx</span><span class="p">,</span> <span class="n">c_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_handles</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">e_idx</span><span class="p">,</span> <span class="n">e_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_handles</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">m_idx</span><span class="p">,</span> <span class="n">m_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center_handle</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;move&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="c1"># Set active handle as closest handle, if mouse click is close enough.</span>
        <span class="k">elif</span> <span class="n">m_dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Prioritise center handle over other handles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
        <span class="k">elif</span> <span class="n">c_dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span> <span class="ow">and</span> <span class="n">e_dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">:</span>
            <span class="c1"># Not close to any handles</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_from_anywhere</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="c1"># Check if we&#39;ve clicked inside the region</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
        <span class="k">elif</span> <span class="n">c_dist</span> <span class="o">&lt;</span> <span class="n">e_dist</span><span class="p">:</span>
            <span class="c1"># Closest to a corner handle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corner_order</span><span class="p">[</span><span class="n">c_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Closest to an edge handle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edge_order</span><span class="p">[</span><span class="n">e_idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if event is within the patch.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an array of shape (2, 5) containing the</span>
<span class="sd">        x (``RectangleSelector.geometry[1, :]``) and</span>
<span class="sd">        y (``RectangleSelector.geometry[0, :]``) data coordinates of the four</span>
<span class="sd">        corners of the rectangle starting and ending in the top left corner.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="p">,</span> <span class="s1">&#39;get_verts&#39;</span><span class="p">):</span>
            <span class="n">xfm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">xfm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_verts</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_data</span><span class="p">())</span>


<span class="nd">@_docstring</span><span class="o">.</span><span class="n">Substitution</span><span class="p">(</span><span class="n">_RECTANGLESELECTOR_PARAMETERS_DOCSTRING</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="s1">&#39;__ARTIST_NAME__&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">))</span>
<span class="k">class</span> <span class="nc">EllipseSelector</span><span class="p">(</span><span class="n">RectangleSelector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select an elliptical region of an Axes.</span>

<span class="sd">    For the cursor to remain responsive you must keep a reference to it.</span>

<span class="sd">    Press and release events triggered at the same coordinates outside the</span>
<span class="sd">    selection will clear the selector, except when</span>
<span class="sd">    ``ignore_event_outside=True``.</span>

<span class="sd">    %s</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    :doc:`/gallery/widgets/rectangle_selector`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">draw_shape</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecate_privatize_attribute</span><span class="p">(</span><span class="s1">&#39;3.5&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">props</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extents</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">extents</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">])</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span> <span class="o">+</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_rect_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawtype</span> <span class="o">==</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">center</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">width</span>
            <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">height</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span>


<span class="k">class</span> <span class="nc">LassoSelector</span><span class="p">(</span><span class="n">_SelectorWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selection curve of an arbitrary shape.</span>

<span class="sd">    For the selector to remain responsive you must keep a reference to it.</span>

<span class="sd">    The selected path can be used in conjunction with `~.Path.contains_point`</span>
<span class="sd">    to select data points from an image.</span>

<span class="sd">    In contrast to `Lasso`, `LassoSelector` is written with an interface</span>
<span class="sd">    similar to `RectangleSelector` and `SpanSelector`, and will continue to</span>
<span class="sd">    interact with the Axes until disconnected.</span>

<span class="sd">    Example usage::</span>

<span class="sd">        ax = plt.subplot()</span>
<span class="sd">        ax.plot(x, y)</span>

<span class="sd">        def onselect(verts):</span>
<span class="sd">            print(verts)</span>
<span class="sd">        lasso = LassoSelector(ax, onselect)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>
<span class="sd">    onselect : function</span>
<span class="sd">        Whenever the lasso is released, the *onselect* function is called and</span>
<span class="sd">        passed the vertices of the selected path.</span>
<span class="sd">    useblit : bool, default: True</span>
<span class="sd">        Whether to use blitting for faster drawing (if supported by the</span>
<span class="sd">        backend). See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>
<span class="sd">    props : dict, optional</span>
<span class="sd">        Properties with which the line is drawn, see `matplotlib.lines.Line2D`</span>
<span class="sd">        for valid properties. Default values are defined in ``mpl.rcParams``.</span>
<span class="sd">    button : `.MouseButton` or list of `.MouseButton`, optional</span>
<span class="sd">        The mouse buttons used for rectangle selection.  Default is ``None``,</span>
<span class="sd">        which corresponds to all buttons.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;lineprops&quot;</span><span class="p">,</span> <span class="s2">&quot;props&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">button</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="n">useblit</span><span class="p">,</span> <span class="n">button</span><span class="o">=</span><span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># self.useblit may be != useblit, if the canvas doesn&#39;t support blit.</span>
        <span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">animated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="o">**</span><span class="n">props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span> <span class="o">=</span> <span class="n">line</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;press&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">onpress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">press</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">event</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;release&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">onrelease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_data</span><span class="p">([[],</span> <span class="p">[]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_data</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PolygonSelector</span><span class="p">(</span><span class="n">_SelectorWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select a polygon region of an Axes.</span>

<span class="sd">    Place vertices with each mouse click, and make the selection by completing</span>
<span class="sd">    the polygon (clicking on the first vertex). Once drawn individual vertices</span>
<span class="sd">    can be moved by clicking and dragging with the left mouse button, or</span>
<span class="sd">    removed by clicking the right mouse button.</span>

<span class="sd">    In addition, the following modifier keys can be used:</span>

<span class="sd">    - Hold *ctrl* and click and drag a vertex to reposition it before the</span>
<span class="sd">      polygon has been completed.</span>
<span class="sd">    - Hold the *shift* key and click and drag anywhere in the Axes to move</span>
<span class="sd">      all vertices.</span>
<span class="sd">    - Press the *esc* key to start a new polygon.</span>

<span class="sd">    For the selector to remain responsive you must keep a reference to it.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>

<span class="sd">    onselect : function</span>
<span class="sd">        When a polygon is completed or modified after completion,</span>
<span class="sd">        the *onselect* function is called and passed a list of the vertices as</span>
<span class="sd">        ``(xdata, ydata)`` tuples.</span>

<span class="sd">    useblit : bool, default: False</span>
<span class="sd">        Whether to use blitting for faster drawing (if supported by the</span>
<span class="sd">        backend). See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>

<span class="sd">    props : dict, optional</span>
<span class="sd">        Properties with which the line is drawn, see `matplotlib.lines.Line2D`</span>
<span class="sd">        for valid properties.</span>
<span class="sd">        Default:</span>

<span class="sd">            ``dict(color=&#39;k&#39;, linestyle=&#39;-&#39;, linewidth=2, alpha=0.5)``</span>

<span class="sd">    handle_props : dict, optional</span>
<span class="sd">        Artist properties for the markers drawn at the vertices of the polygon.</span>
<span class="sd">        See the marker arguments in `matplotlib.lines.Line2D` for valid</span>
<span class="sd">        properties.  Default values are defined in ``mpl.rcParams`` except for</span>
<span class="sd">        the default value of ``markeredgecolor`` which will be the same as the</span>
<span class="sd">        ``color`` property in *props*.</span>

<span class="sd">    grab_range : float, default: 10</span>
<span class="sd">        A vertex is selected (to complete the polygon or to move a vertex) if</span>
<span class="sd">        the mouse click is within *grab_range* pixels of the vertex.</span>

<span class="sd">    draw_bounding_box : bool, optional</span>
<span class="sd">        If `True`, a bounding box will be drawn around the polygon selector</span>
<span class="sd">        once it is complete. This box can be used to move and resize the</span>
<span class="sd">        selector.</span>

<span class="sd">    box_handle_props : dict, optional</span>
<span class="sd">        Properties to set for the box handles. See the documentation for the</span>
<span class="sd">        *handle_props* argument to `RectangleSelector` for more info.</span>

<span class="sd">    box_props : dict, optional</span>
<span class="sd">        Properties to set for the box. See the documentation for the *props*</span>
<span class="sd">        argument to `RectangleSelector` for more info.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    :doc:`/gallery/widgets/polygon_selector_simple`</span>
<span class="sd">    :doc:`/gallery/widgets/polygon_selector_demo`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If only one point remains after removing points, the selector reverts to an</span>
<span class="sd">    incomplete state and you can start drawing a new polygon from the existing</span>
<span class="sd">    point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;lineprops&quot;</span><span class="p">,</span> <span class="s2">&quot;props&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;markerprops&quot;</span><span class="p">,</span> <span class="s2">&quot;handle_props&quot;</span><span class="p">)</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">rename_parameter</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="s2">&quot;vertex_select_radius&quot;</span><span class="p">,</span> <span class="s2">&quot;grab_range&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handle_props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grab_range</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">draw_bounding_box</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">box_handle_props</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">box_props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># The state modifiers &#39;move&#39;, &#39;square&#39;, and &#39;center&#39; are expected by</span>
        <span class="c1"># _SelectorWidget but are not supported by PolygonSelector</span>
        <span class="c1"># Note: could not use the existing &#39;move&#39; state modifier in-place of</span>
        <span class="c1"># &#39;move_all&#39; because _SelectorWidget automatically discards &#39;move&#39;</span>
        <span class="c1"># from the state on button release.</span>
        <span class="n">state_modifier_keys</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="s1">&#39;escape&#39;</span><span class="p">,</span> <span class="n">move_vertex</span><span class="o">=</span><span class="s1">&#39;control&#39;</span><span class="p">,</span>
                                   <span class="n">move_all</span><span class="o">=</span><span class="s1">&#39;shift&#39;</span><span class="p">,</span> <span class="n">move</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">,</span>
                                   <span class="n">square</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">,</span>
                                   <span class="n">center</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">,</span>
                                   <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;not-applicable&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">onselect</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="n">useblit</span><span class="p">,</span>
                         <span class="n">state_modifier_keys</span><span class="o">=</span><span class="n">state_modifier_keys</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;animated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_props</span> <span class="o">=</span> <span class="n">props</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span> <span class="o">=</span> <span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">handle_props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">handle_props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                                <span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span> <span class="o">=</span> <span class="n">handle_props</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_polygon_handles</span> <span class="o">=</span> <span class="n">ToolHandles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span>
                                            <span class="n">useblit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">,</span>
                                            <span class="n">marker_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span> <span class="o">=</span> <span class="n">grab_range</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_box</span> <span class="o">=</span> <span class="n">draw_bounding_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">box_handle_props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">box_handle_props</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box_handle_props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">box_handle_props</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box_props</span> <span class="o">=</span> <span class="n">box_props</span>

    <span class="k">def</span> <span class="nf">_get_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">RectangleSelector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span>
                                      <span class="n">onselect</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                      <span class="n">useblit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">,</span>
                                      <span class="n">grab_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">,</span>
                                      <span class="n">handle_props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_handle_props</span><span class="p">,</span>
                                      <span class="n">props</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_box_props</span><span class="p">,</span>
                                      <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;rotate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_polygon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_box</span><span class="p">()</span>
        <span class="c1"># Set state that prevents the RectangleSelector from being created</span>
        <span class="c1"># by the user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_allow_creation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_remove_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_update_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Update selection box extents to the extents of the polygon</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bbox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">extents</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">bbox</span><span class="o">.</span><span class="n">y1</span><span class="p">]</span>
            <span class="c1"># Save a copy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_old_box_extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">extents</span>

    <span class="k">def</span> <span class="nf">_scale_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale the polygon selector points when the bounding box is moved or</span>
<span class="sd">        scaled.</span>

<span class="sd">        This is set as a callback on the bounding box RectangleSelector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_old_box_extents</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">extents</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Create transform from old box to new box</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">_rect_bbox</span>
        <span class="n">old_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bbox</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span>
             <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="n">old_bbox</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="o">-</span><span class="n">old_bbox</span><span class="o">.</span><span class="n">y0</span><span class="p">)</span>
             <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">old_bbox</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">old_bbox</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
             <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">h1</span><span class="p">)</span>
             <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span>

        <span class="c1"># Update polygon verts.  Must be a list of tuples for consistency.</span>
        <span class="n">new_verts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">new_verts</span><span class="p">,</span> <span class="n">new_verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_box_extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="o">.</span><span class="n">extents</span>

    <span class="n">line</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="n">vertex_select_radius</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;vertex_select_radius&quot;</span><span class="p">,</span>
                                           <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;grab_range&quot;</span><span class="p">)(</span>
        <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">,</span>
                 <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;grab_range&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_handles_artists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polygon_handles</span><span class="o">.</span><span class="n">artists</span>

    <span class="k">def</span> <span class="nf">_remove_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove vertex with index i.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="ow">and</span>
                <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="c1"># If selecting the first or final vertex, remove both first and</span>
            <span class="c1"># last vertex as they are the same for a closed polygon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Close the polygon again by appending the new first vertex to the</span>
            <span class="c1"># end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># If only one point left, return to incomplete state to let user</span>
            <span class="c1"># start drawing again</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_box</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button press event handler.&quot;&quot;&quot;</span>
        <span class="c1"># Check for selection of a tool handle.</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="ow">or</span> <span class="s1">&#39;move_vertex&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">h_idx</span><span class="p">,</span> <span class="n">h_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polygon_handles</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">h_dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span> <span class="o">=</span> <span class="n">h_idx</span>
        <span class="c1"># Save the vertex positions at the time of the press event (needed to</span>
        <span class="c1"># support the &#39;move_all&#39; state modifier).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xys_at_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Button release event handler.&quot;&quot;&quot;</span>
        <span class="c1"># Release active tool handle.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remove_vertex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Complete the polygon.</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_box</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_box</span><span class="p">()</span>

        <span class="c1"># Place new vertex.</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span>
              <span class="ow">and</span> <span class="s1">&#39;move_all&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
              <span class="ow">and</span> <span class="s1">&#39;move_vertex&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onselect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cursor move event handler and validator.&quot;&quot;&quot;</span>
        <span class="c1"># Method overrides _SelectorWidget.onmove because the polygon selector</span>
        <span class="c1"># needs to process the move callback even if there is no button press.</span>
        <span class="c1"># _SelectorWidget.onmove include logic to ignore move event if</span>
        <span class="c1"># _eventpress is None.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onmove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cursor move event handler.&quot;&quot;&quot;</span>
        <span class="c1"># Move the active vertex (ToolHandle).</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_handle_idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
            <span class="c1"># Also update the end of the polygon line if the first vertex is</span>
            <span class="c1"># the active handle and the polygon is completed.</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

        <span class="c1"># Move all vertices.</span>
        <span class="k">elif</span> <span class="s1">&#39;move_all&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">xdata</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventpress</span><span class="o">.</span><span class="n">ydata</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)):</span>
                <span class="n">x_at_press</span><span class="p">,</span> <span class="n">y_at_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys_at_press</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_at_press</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y_at_press</span> <span class="o">+</span> <span class="n">dy</span>

        <span class="c1"># Do nothing if completed or waiting for a move.</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span>
              <span class="ow">or</span> <span class="s1">&#39;move_vertex&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">or</span> <span class="s1">&#39;move_all&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Position pending vertex.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate distance to the start vertex.</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">v0_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="c1"># Lock on to the start vertex if near it and ready to complete.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">v0_dist</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">grab_range</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Key press event handler.&quot;&quot;&quot;</span>
        <span class="c1"># Remove the pending vertex if entering the &#39;move_vertex&#39; or</span>
        <span class="c1"># &#39;move_all&#39; mode</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span>
                <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;move_vertex&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">or</span>
                     <span class="s1">&#39;move_all&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_key_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Key release event handler.&quot;&quot;&quot;</span>
        <span class="c1"># Add back the pending vertex if leaving the &#39;move_vertex&#39; or</span>
        <span class="c1"># &#39;move_all&#39; mode (by checking the released key)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span>
                <span class="ow">and</span>
                <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;move_vertex&#39;</span><span class="p">)</span>
                 <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;move_all&#39;</span><span class="p">))):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>
        <span class="c1"># Reset the polygon if the released key is the &#39;clear&#39; key.</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_modifier_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_box</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Redraw the polygon based on the new vertex positions.&quot;&quot;&quot;</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span> <span class="k">else</span> <span class="p">([],</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_artist</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_box</span><span class="p">()</span>
        <span class="c1"># Only show one tool handle at the start and end vertex of the polygon</span>
        <span class="c1"># if the polygon is completed or the user is locked on to the start</span>
        <span class="c1"># vertex.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span>
                <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_polygon_handles</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_polygon_handles</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">verts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The polygon vertices, as a list of ``(x, y)`` pairs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@verts</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">verts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the polygon vertices.</span>

<span class="sd">        This will remove any preexisting vertices, creating a complete polygon</span>
<span class="sd">        with the new vertices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xys</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">xys</span><span class="p">,</span> <span class="n">xys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_completed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_box</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_box</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_polygon</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Lasso</span><span class="p">(</span><span class="n">AxesWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selection curve of an arbitrary shape.</span>

<span class="sd">    The selected path can be used in conjunction with</span>
<span class="sd">    `~matplotlib.path.Path.contains_point` to select data points from an image.</span>

<span class="sd">    Unlike `LassoSelector`, this must be initialized with a starting</span>
<span class="sd">    point *xy*, and the `Lasso` events are destroyed upon release.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : `~matplotlib.axes.Axes`</span>
<span class="sd">        The parent Axes for the widget.</span>
<span class="sd">    xy : (float, float)</span>
<span class="sd">        Coordinates of the start of the lasso.</span>
<span class="sd">    useblit : bool, default: True</span>
<span class="sd">        Whether to use blitting for faster drawing (if supported by the</span>
<span class="sd">        backend). See the tutorial :doc:`/tutorials/advanced/blitting`</span>
<span class="sd">        for details.</span>
<span class="sd">    callback : callable</span>
<span class="sd">        Whenever the lasso is released, the *callback* function is called and</span>
<span class="sd">        passed the vertices of the selected path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span> <span class="o">=</span> <span class="n">useblit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">supports_blit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onrelease</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_event</span><span class="p">(</span><span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onmove</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onrelease</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_events</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">onmove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useblit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Alexander Puck Neuwirth.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>